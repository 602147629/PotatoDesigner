<?xml version="1.0" encoding="utf-8"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009" 
					   xmlns:s="library://ns.adobe.com/flex/spark" 
					   xmlns:mx="library://ns.adobe.com/flex/mx"
					   initialize="windowedapplication1_initializeHandler(event)">
	<fx:Script>
		<![CDATA[
			import mx.events.FlexEvent;
			
			import potato.designer.net.Connection;
			import potato.designer.net.Message;
			import potato.designer.net.NetConst;
			
			
			protected var connection:Connection;
			protected var serverSocket:ServerSocket;
			
			
			protected function windowedapplication1_initializeHandler(event:FlexEvent):void
			{
				
				// TODO Auto-generated method stub
				serverSocket = new ServerSocket;
				serverSocket.bind(NetConst.PORT, "0.0.0.0");
				serverSocket.listen();
				serverSocket.addEventListener(ServerSocketConnectEvent.CONNECT, connectHandler);
				trace("开始侦听");
			}
			
			protected function connectHandler(e:ServerSocketConnectEvent):void
			{
				trace("已经连接");
				connection = new Connection(e.socket);
				connection.send(NetConst.S2C_HELLO, "hello world!");
				connection.addEventListener(NetConst.C2S_HELLO, clientInitHandler);
			}
			protected function clientInitHandler(e:Message):void
			{
				connection.send(NetConst.S2C_REQ_DESCRIBE_TYPE, "flash.display.Sprite", onDescribeTypeHandler);
				function onDescribeTypeHandler(msg:Message):void
				{
					trace("收到解析", msg.data);
				}
				
				connection.addEventListener(NetConst.C2S_LOG, onLogHandler);
				function onLogHandler(msg:Message):void
				{
					trace("[Ghost]", msg.data);
				}
			}
			
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
	</fx:Declarations>
</s:WindowedApplication>
